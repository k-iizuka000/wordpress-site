# WordPressテーマ「kei-portfolio」有効化テスト設計書

## 1. テスト概要

### 目的
WordPressテーマ「kei-portfolio」の有効化プロセスが正常に動作し、必要な初期設定が適切に行われることを確認する。

### テスト対象
- テーマ有効化機能
- テーマ初期設定
- 基本的な表示確認

### 既存テストとの関連性
- **SetupTest.php**: テーマの基本設定（theme support、メニュー登録、画像サイズ等）をカバー済み
- **FunctionsTest.php**: functions.phpと必要なファイルの存在確認をカバー済み
- **新規テスト必要性**: テーマ有効化時の動作、データ移行、初期表示に特化したテストが必要

## 2. テストグループ設計

### グループ1: テーマ有効化前検証テスト
**目的**: テーマ有効化前の環境確認と前提条件の検証

#### テストケース
1. **テーマファイル完全性チェック**
   - 必須ファイル（style.css、index.php、functions.php）の存在確認
   - テーマヘッダー情報の妥当性確認
   - テンプレートファイル階層の確認

2. **依存関係チェック**
   - PHP最小バージョン（7.4+）の確認
   - WordPress最小バージョンの確認
   - 必要なPHP拡張モジュールの確認

3. **権限チェック**
   - テーマディレクトリの書き込み権限
   - アップロードディレクトリの権限
   - キャッシュディレクトリの権限

### グループ2: テーマ有効化プロセステスト
**目的**: 有効化処理の正常性確認

#### テストケース
1. **有効化フック実行テスト**
   - `after_switch_theme`フックの実行確認
   - 初期設定関数の呼び出し確認
   - エラーハンドリングの確認

2. **データ移行テスト**
   - portfolio.jsonからのデータインポート
   - カスタム投稿タイプの自動生成
   - メタデータの正確な移行

3. **設定初期化テスト**
   - デフォルトメニューの作成
   - ウィジェットエリアの初期化
   - カスタマイザー設定のデフォルト値設定

### グループ3: 有効化後の表示確認テスト
**目的**: テーマ有効化後の基本的な表示機能の確認

#### テストケース
1. **フロントページ表示テスト**
   - ヒーローセクションの表示
   - ナビゲーションメニューの表示
   - フッターの表示

2. **テンプレート適用テスト**
   - 投稿ページのレイアウト
   - 固定ページのレイアウト
   - アーカイブページのレイアウト
   - 404ページの表示

3. **レスポンシブデザインテスト**
   - モバイル表示の確認
   - タブレット表示の確認
   - デスクトップ表示の確認

### グループ4: カスタム投稿タイプテスト
**目的**: projectカスタム投稿タイプの動作確認

#### テストケース
1. **投稿タイプ登録テスト**（既存：CustomPostTypeTest.phpでカバー）
   - 'project'投稿タイプの登録確認
   - タクソノミーの登録確認
   - 権限設定の確認

2. **プロジェクト表示テスト**
   - シングルプロジェクトページの表示
   - プロジェクトアーカイブページの表示
   - プロジェクトメタデータの表示

3. **プロジェクトフィルタリングテスト**
   - タクソノミーによるフィルタリング
   - JavaScriptフィルターの動作
   - ページネーションの動作

### グループ5: アセット読み込みテスト
**目的**: CSS/JSファイルの適切な読み込み確認

#### テストケース（既存：EnqueueTest.phpで一部カバー）
1. **スタイルシート読み込みテスト**
   - style.cssの読み込み
   - Tailwind CSSビルドファイルの読み込み
   - 条件付きスタイルの読み込み

2. **JavaScript読み込みテスト**
   - main.jsの読み込み
   - navigation.jsの読み込み
   - portfolio-filter.jsの読み込み
   - 依存関係の正しい順序

3. **最適化テスト**
   - 不要なアセットの除外
   - 遅延読み込みの確認
   - Critical CSSの適用

### グループ6: セキュリティテスト
**目的**: テーマ有効化時のセキュリティ確認

#### テストケース（既存：SecurityTest.phpで一部カバー）
1. **ファイルアクセス制御テスト**
   - 直接ファイルアクセスの防止
   - テンプレートファイルの保護
   - 設定ファイルの保護

2. **データサニタイズテスト**
   - 入力データのサニタイズ
   - 出力データのエスケープ
   - SQLインジェクション対策

3. **権限チェックテスト**
   - 管理者権限の確認
   - ユーザー権限の適切な制限
   - nonceの実装確認

### グループ7: パフォーマンステスト
**目的**: テーマのパフォーマンス最適化の確認

#### テストケース（既存：PerformanceTest.phpで一部カバー）
1. **読み込み速度テスト**
   - ページ読み込み時間の測定
   - データベースクエリ数の確認
   - メモリ使用量の確認

2. **キャッシング動作テスト**
   - オブジェクトキャッシュの利用
   - ページキャッシュの動作
   - 静的リソースのキャッシュ設定

3. **画像最適化テスト**
   - 適切な画像サイズの生成
   - 遅延読み込みの実装
   - WebP対応の確認

### グループ8: 互換性テスト
**目的**: WordPress環境との互換性確認

#### テストケース
1. **WordPressバージョン互換性テスト**
   - 最新バージョンでの動作
   - 最小サポートバージョンでの動作
   - 非推奨関数の未使用確認

2. **プラグイン互換性テスト**
   - 主要SEOプラグインとの互換性
   - キャッシュプラグインとの互換性
   - セキュリティプラグインとの互換性

3. **ブラウザ互換性テスト**
   - Chrome/Edge最新版
   - Firefox最新版
   - Safari最新版
   - モバイルブラウザ

### グループ9: 国際化（i18n）テスト
**目的**: 多言語対応の確認

#### テストケース
1. **テキストドメインテスト**（既存：SetupTest.phpで一部カバー）
   - テキストドメインの読み込み
   - 翻訳関数の使用確認
   - POTファイルの生成可能性

2. **日本語表示テスト**
   - 日本語コンテンツの正常表示
   - 日付フォーマットの適切な表示
   - メタ情報の日本語対応

3. **文字エンコーディングテスト**
   - UTF-8エンコーディングの確認
   - 特殊文字の処理
   - フォームデータの処理

### グループ10: エラーハンドリングテスト
**目的**: エラー時の適切な処理確認

#### テストケース
1. **テーマ有効化エラー処理**
   - 必須ファイル不足時の処理
   - PHPエラー発生時の処理
   - データベースエラー時の処理

2. **フォールバック機能テスト**
   - テンプレート不在時のフォールバック
   - 画像不在時の代替表示
   - JavaScript無効時の動作

3. **エラーログテスト**
   - エラーの適切な記録
   - デバッグ情報の出力制御
   - ユーザーへのエラー通知

## 3. 実装優先度

### 高優先度（必須）
1. グループ1: テーマ有効化前検証テスト
2. グループ2: テーマ有効化プロセステスト
3. グループ3: 有効化後の表示確認テスト

### 中優先度（推奨）
4. グループ4: カスタム投稿タイプテスト（一部既存）
5. グループ6: セキュリティテスト（一部既存）
6. グループ10: エラーハンドリングテスト

### 低優先度（オプション）
7. グループ5: アセット読み込みテスト（既存で十分）
8. グループ7: パフォーマンステスト（既存で十分）
9. グループ8: 互換性テスト
10. グループ9: 国際化テスト（一部既存）

## 4. 新規作成が必要なテストファイル

### 必須作成ファイル
1. **ThemeActivationTest.php**
   - グループ1、2の実装
   - テーマ有効化の中核機能をテスト

2. **ThemeDisplayTest.php**
   - グループ3の実装
   - 基本的な表示機能をテスト

3. **ErrorHandlingTest.php**
   - グループ10の実装
   - エラー処理の確認

### 既存ファイルの拡張
- **CustomPostTypeTest.php**: プロジェクト表示テストを追加
- **SecurityTest.php**: テーマ有効化時のセキュリティチェックを追加

## 5. テスト実行計画

### 単体テスト実行
```bash
# 個別テスト実行
phpunit tests/ThemeActivationTest.php
phpunit tests/ThemeDisplayTest.php
phpunit tests/ErrorHandlingTest.php

# グループ単位での実行
phpunit --group theme-activation
phpunit --group theme-display
phpunit --group error-handling
```

### 統合テスト実行
```bash
# 全テーマ有効化関連テスト実行
phpunit --testsuite theme-activation-suite
```

### カバレッジ測定
```bash
# コードカバレッジレポート生成
phpunit --coverage-html coverage/theme-activation
```

## 6. 成功基準

- 全テストケースの合格率: 100%
- コードカバレッジ: 80%以上
- パフォーマンス基準: ページ読み込み3秒以内
- セキュリティ脆弱性: 0件
- PHPエラー/警告: 0件

## 7. テスト環境要件

### 必須環境
- WordPress 6.0以上
- PHP 7.4以上
- MySQL 5.7以上 / MariaDB 10.3以上
- PHPUnit 9.0以上

### 推奨環境
- WordPress最新版
- PHP 8.0以上
- 十分なメモリ（256MB以上）
- WP_DEBUG有効

## 8. 注意事項

1. **データベースバックアップ**
   - テスト実行前に必ずバックアップを取得
   - テストデータベースの使用を推奨

2. **テストデータ**
   - portfolio.jsonのテストデータを準備
   - ダミー画像ファイルの準備
   - サンプルコンテンツの用意

3. **並行実行**
   - テストの独立性を保証
   - 順序依存を避ける
   - トランザクション内でのテスト実行

4. **クリーンアップ**
   - 各テスト後のデータクリーンアップ
   - 一時ファイルの削除
   - 設定のリセット