# テーマディレクトリ移動影響調査レポート

## 調査日時
2025年8月7日

## 調査概要
WordPressテーマディレクトリを `/wordpress/wp-content/themes/kei-portfolio` から `/themes/kei-portfolio` に移動する際の影響を包括的に調査しました。

## 現在の構造
```
/Users/kei/work/wordpress-site/
├── wordpress/
│   └── wp-content/
│       └── themes/
│           └── kei-portfolio/  # 現在のテーマ位置
├── docker-compose.yml
├── Dockerfile
└── wp-config.docker.php
```

## 調査結果サマリー

### 1. テーマ内部のパス参照 ✅ 影響なし
**functions.php および inc/* ファイル**
- すべて `get_template_directory()` を使用
- WordPressの関数が自動的に正しいパスを解決
- **修正不要**

### 2. Docker環境設定 ⚠️ 要修正
**影響を受けるファイル：**
1. `docker-compose.yml` (20行目)
   - 現在: `./wordpress/wp-content/themes/kei-portfolio:/var/www/html/wp-content/themes/kei-portfolio:cached`
   - 修正後: `./themes/kei-portfolio:/var/www/html/wp-content/themes/kei-portfolio:cached`

2. `Dockerfile` (88行目)
   - 現在: `COPY wordpress/wp-content/themes/kei-portfolio/ ./wp-content/themes/kei-portfolio/`
   - 修正後: `COPY themes/kei-portfolio/ ./wp-content/themes/kei-portfolio/`

3. その他のDockerファイル（確認必要）
   - `Dockerfile.optimized`
   - `docker-compose.optimized.yml`
   - `docker-compose.simple.yml`
   - `docker-compose.test.yml`

### 3. テストファイル ⚠️ 一部要修正
**bootstrap.php (67行目)**
- 現在: `define( 'ABSPATH', dirname( dirname( dirname( dirname( __DIR__ ) ) ) ) . '/' );`
- パスの階層が変わるため修正が必要
- 修正後: `define( 'ABSPATH', dirname( dirname( __DIR__ ) ) . '/' );`

**coverage/coverage-final.json**
- ハードコードされた絶対パスが存在
- カバレッジ結果ファイルなので、再生成で対応可能

### 4. ビルド・開発ツール ✅ 影響なし
**package.json / composer.json**
- すべて相対パスを使用
- テーマディレクトリ内で完結
- **修正不要**

### 5. WordPress内部 ⚠️ 要確認
**データベース内の参照**
- テーマ設定がデータベースに保存されている可能性
- 移動後にテーマの再有効化が必要な場合がある

## 影響度評価

| カテゴリ | 影響度 | 修正必要性 | リスク |
|---------|--------|------------|--------|
| テーマ内部コード | なし | 不要 | 低 |
| Docker設定 | 高 | 必須 | 中 |
| テスト環境 | 中 | 必須 | 低 |
| ビルドツール | なし | 不要 | 低 |
| WordPress DB | 低 | 確認要 | 低 |

## メリット・デメリット分析

### メリット
1. **プロジェクト構造の簡潔化**
   - 階層が浅くなり、ナビゲーションが容易に
   - プロジェクトルートからテーマへのアクセスが速い

2. **開発効率の向上**
   - パスが短くなり、コマンドライン操作が簡単に
   - IDE/エディタでのファイル検索が高速化

3. **Git管理の最適化**
   - WordPressコアファイルとテーマの分離が明確に
   - `.gitignore` の設定がシンプルに

### デメリット
1. **標準構造からの逸脱**
   - WordPress標準のディレクトリ構造と異なる
   - 新規開発者の混乱の可能性

2. **移行作業のリスク**
   - Docker設定の修正ミスによる動作不良の可能性
   - テスト環境の再構築が必要

3. **互換性の懸念**
   - 一部のWordPressツールが標準パスを前提にしている可能性
   - プラグインとの相性問題（まれ）

## リスク評価

### 高リスク項目
- Docker環境の設定ミスによるコンテナ起動失敗

### 中リスク項目
- テスト環境のパス解決エラー
- データベース内のテーマ設定の不整合

### 低リスク項目
- 開発ツール（npm, composer）の動作
- テーマ内部のコード実行

## 推奨事項

### 移動を推奨しない理由
1. **標準構造の維持**
   - WordPressの標準的なディレクトリ構造を維持することで、長期的な保守性が向上
   - 将来的なWordPressアップデートへの対応が容易

2. **移行コスト対効果**
   - 得られるメリットに対して、移行作業とリスクが大きい
   - 現状で開発に支障がない

3. **チーム開発への配慮**
   - 新規メンバーが参加した際の学習コストが低い
   - WordPress開発の標準的な知識がそのまま適用可能

### 代替案
もし構造を簡潔にしたい場合は、以下の代替案を検討：

1. **シンボリックリンクの活用**
   ```bash
   ln -s wordpress/wp-content/themes/kei-portfolio themes
   ```

2. **環境変数によるパス管理**
   - Docker環境変数でテーマパスを定義
   - スクリプトで参照を一元管理

3. **開発用エイリアスの設定**
   - シェルエイリアスで短縮パスを定義
   - VSCodeのワークスペース設定でルートを調整

## 結論
技術的には移動可能ですが、標準構造を維持することを推奨します。移動による利点は限定的で、リスクと作業コストが相対的に高いためです。

もし移動を実施する場合は、次の「テーマディレクトリ移動設計書」に従って慎重に作業を進めてください。