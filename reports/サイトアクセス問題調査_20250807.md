# WordPressサイトアクセス問題調査報告書

調査日時: 2025年8月7日

## 調査結果サマリー

### 主要な問題
**データベースのサイトURL設定が不正でした**
- `wp_dev_options`テーブルの`siteurl`と`home`が`http:///var/www/html`という不正な値になっていた
- この問題を修正済み（`http://localhost:8090`に変更）

## 詳細調査結果

### 1. Docker環境の確認 ✅
- **コンテナ稼働状態**: 正常稼働中
  - kei-portfolio-dev (WordPress): UP 2 hours (healthy)
  - kei-portfolio-db (MariaDB): UP 2 hours
  - kei-portfolio-pma (phpMyAdmin): UP 2 hours
- **ポートマッピング**: 正常（0.0.0.0:8090→80/tcp）
- **ログ**: ヘルスチェック（curl）が正常に動作中

### 2. WordPressの状態 ⚠️→✅
- **データベース接続**: 正常
  - データベース名: kei_portfolio_dev
  - ユーザー: wp_user
  - ホスト: db:3306
  - 全テーブル（12個）が存在
- **サイトURL設定**: **修正済み**
  - 修正前: `http:///var/www/html`（不正）
  - 修正後: `http://localhost:8090`（正常）
- **テーマ設定**: kei-portfolioテーマが有効

### 3. テーマファイルの確認 ✅
- **必須ファイル**: すべて存在
  - index.php
  - style.css
  - functions.php
  - header.php
  - footer.php
- **PHPエラー**: なし（構文チェック合格）
- **ファイル権限**: 正常（644）

### 4. ネットワーク関連 ✅
- **ポート8090**: 正常にリッスン中
- **Docker network**: 2つのネットワークが存在
  - wordpress-site_default
  - wordpress-site_kei-portfolio-network

## 問題の原因

### 根本原因
データベースの`siteurl`と`home`オプションが不正な値（`http:///var/www/html`）に設定されていたため、WordPressが正しくリダイレクトできない状態でした。

### 発生理由（推測）
- Docker環境でのWordPress初期設定時に、環境変数が正しく渡されなかった
- またはマイグレーション時にURLの変換が失敗した

## 実施した修正

1. **データベースのURL修正**
   ```sql
   UPDATE wp_dev_options 
   SET option_value='http://localhost:8090' 
   WHERE option_name IN ('siteurl', 'home');
   ```

## 今後の推奨事項

### 優先度：高
1. **ブラウザでサイトアクセスを確認**
   - http://localhost:8090 にアクセスして正常に表示されるか確認

2. **キャッシュクリア**
   - ブラウザのキャッシュをクリア
   - WordPressのキャッシュプラグインがある場合はクリア

### 優先度：中
1. **環境変数の見直し**
   - docker-compose.ymlでWORDPRESS_URL環境変数を正しく設定
   - wp-config.phpでの環境変数読み込みを確認

2. **ヘルスチェックの改善**
   - 現在はinstall.phpをチェックしているが、実際のサイトURLをチェックするよう変更

### 優先度：低
1. **バックアップの実施**
   - データベースの定期バックアップ設定
   - テーマファイルのバージョン管理

## 修正後の状態確認方法

1. ブラウザで http://localhost:8090 にアクセス
2. WordPressサイトが正常に表示されることを確認
3. 管理画面（http://localhost:8090/wp-admin）にログイン可能か確認
4. テーマ（kei-portfolio）が正しく適用されているか確認

## 技術的な学習ポイント

- WordPressのサイトURL設定はデータベースに保存され、これが不正だとサイト全体がアクセス不能になる
- Docker環境では環境変数の受け渡しに注意が必要
- ヘルスチェックは実際のアプリケーション動作を確認するようにすべき