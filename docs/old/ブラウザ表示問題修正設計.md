# ブラウザ表示問題修正設計書

## 設計日時
2025年8月7日

## 修正目標
Chromeブラウザでhttp://localhost:8090にアクセスした際に、WordPressサイトが正常に表示されるようにする

## 修正方針

### 方針1: Tailwind CSSを追加（推奨）
ReactからWordPressへの移行時の意図を尊重し、Tailwind CSSを適切に追加する

### 方針2: 通常のCSSに置き換え
Tailwind CSSクラスを削除し、style.cssに必要なスタイルを追加する

**本設計書では方針1（Tailwind CSS追加）を推奨します**

## 修正設計詳細

### フェーズ1: 即時対応（優先度: 最高）

#### 1.1 Tailwind CSSの追加
**ファイル**: `/wordpress/wp-content/themes/kei-portfolio/inc/enqueue.php`

```php
// 追加するコード（kei_portfolio_pro_scripts関数内）
// Tailwind CSS CDN
wp_enqueue_style( 
    'tailwindcss', 
    'https://cdn.tailwindcss.com', 
    array(), 
    '3.4.0' 
);
```

**実装位置**: Google Fontsの後、Remix Iconの前

#### 1.2 wp-config.docker.phpの関数定義順序修正
**ファイル**: `/wp-config.docker.php`

```php
// 関数定義を先頭に移動
function getenv_docker($name, $default) {
    $env = getenv($name);
    return $env !== false ? $env : $default;
}

// その後でdefine文を記述
define( 'DB_NAME', getenv_docker('WORDPRESS_DB_NAME', 'kei_portfolio_dev') );
// 以下続く...
```

### フェーズ2: 安定化対応（優先度: 高）

#### 2.1 Tailwind CSS設定ファイルの作成
**新規ファイル**: `/wordpress/wp-content/themes/kei-portfolio/tailwind.config.js`

```javascript
module.exports = {
  content: [
    './**/*.php',
    './assets/js/**/*.js'
  ],
  theme: {
    extend: {
      colors: {
        // カスタムカラー定義
      }
    }
  },
  plugins: []
}
```

#### 2.2 ビルドプロセスの構築
**package.json**の更新でTailwind CSSのビルドプロセスを追加

### フェーズ3: 最適化対応（優先度: 中）

#### 3.1 画像の内部管理
- 外部API画像URLをローカル画像に置き換え
- WordPress メディアライブラリの活用

#### 3.2 パフォーマンス最適化
- Tailwind CSSのPurge設定
- Critical CSSの抽出
- 不要なCSSの削除

## 実装手順

### ステップ1: バックアップ作成
```bash
# テーマフォルダのバックアップ
cp -r wordpress/wp-content/themes/kei-portfolio wordpress/wp-content/themes/kei-portfolio.backup
```

### ステップ2: Tailwind CSS追加
1. enqueue.phpを編集
2. Tailwind CSS CDNリンクを追加

### ステップ3: wp-config.php修正
1. wp-config.docker.phpの関数定義順序を修正

### ステップ4: 動作確認
1. Dockerコンテナを再起動
2. ブラウザでhttp://localhost:8090にアクセス
3. デベロッパーツールでエラー確認

### ステップ5: 追加調整
必要に応じて以下を実施：
- カスタムCSSの追加
- レスポンシブデザインの調整
- JavaScriptエラーの修正

## 影響範囲

### 影響を受けるファイル
- `/wordpress/wp-content/themes/kei-portfolio/inc/enqueue.php`
- `/wp-config.docker.php`

### 影響を受ける機能
- サイト全体の表示
- レスポンシブデザイン
- インタラクティブ要素

## ロールバック手順

問題が発生した場合：

1. **テーマのロールバック**
```bash
rm -rf wordpress/wp-content/themes/kei-portfolio
mv wordpress/wp-content/themes/kei-portfolio.backup wordpress/wp-content/themes/kei-portfolio
```

2. **Dockerコンテナの再起動**
```bash
docker-compose down
docker-compose up -d
```

## テスト項目

### 基本動作確認
- [ ] トップページが表示される
- [ ] ナビゲーションメニューが機能する
- [ ] レスポンシブデザインが適用される
- [ ] フッターが正しく表示される

### ブラウザ互換性
- [ ] Chrome
- [ ] Firefox
- [ ] Safari
- [ ] Edge

### エラー確認
- [ ] JavaScriptコンソールエラーなし
- [ ] PHP警告・エラーなし
- [ ] 404エラーなし

## リスク評価

### リスク項目
1. **CDN依存**: Tailwind CSS CDNへの依存
   - 対策: 本番環境ではローカルビルドに移行

2. **パフォーマンス**: CDN版Tailwindは全CSSを含む
   - 対策: 将来的にPurge設定で最適化

3. **互換性**: 既存のstyle.cssとの競合
   - 対策: 詳細度の調整、必要に応じて!important使用

## 成功基準
- Chromeブラウザでサイトが正常に表示される
- レイアウトが意図通りに表示される
- エラーログにPHPエラーが記録されない
- JavaScriptコンソールにエラーが表示されない

## 今後の推奨事項
1. Tailwind CSSのローカルビルド環境構築
2. カスタムコンポーネントの作成
3. パフォーマンス測定と最適化
4. セキュリティ監査の実施