# ナビゲーションリンク404エラー修正設計書

## 調査結果サマリー

### 問題の根本原因
WordPressデータベースに固定ページが作成されていないため、ナビゲーションリンクが404エラーになっている。

### 現在の状況
1. **テンプレートファイル**: 正常に存在
   - `/themes/kei-portfolio/page-templates/page-about.php`
   - `/themes/kei-portfolio/page-templates/page-skills.php`
   - `/themes/kei-portfolio/page-templates/page-contact.php`
   - `/themes/kei-portfolio/page-templates/page-portfolio.php`

2. **固定ページ**: 未作成
   - データベースには「Sample Page」のみ存在
   - About、Skills、Contact、Portfolioページが存在しない

3. **カスタム投稿タイプ**: 正常に登録
   - `project`投稿タイプが正しく設定されている
   - `projects`スラッグでアーカイブページが有効

4. **リライトルール**: 正常
   - `.htaccess`は標準的なWordPress設定

## 修正設計

### 実装グループ分け（全3グループ）

#### グループ1: 固定ページ作成スクリプトの実装
**作業内容**:
1. 固定ページ自動作成スクリプトの作成
2. ページテンプレート割り当て機能の実装
3. テーマ有効化時の自動実行設定

**対象ファイル**:
- 新規作成: `/themes/kei-portfolio/inc/page-creator.php`
- 更新: `/themes/kei-portfolio/functions.php`

#### グループ2: テスト実装とデータ投入
**作業内容**:
1. 固定ページ作成テストの実装
2. サンプルプロジェクトデータの投入スクリプト作成
3. ナビゲーションメニュー設定の自動化

**対象ファイル**:
- 新規作成: `/themes/kei-portfolio/tests/PageCreationTest.php`
- 新規作成: `/themes/kei-portfolio/inc/sample-data.php`
- 新規作成: `/themes/kei-portfolio/inc/menu-setup.php`

#### グループ3: 検証とドキュメント化
**作業内容**:
1. 全ページのアクセステスト実施
2. 管理画面での設定手順書作成
3. トラブルシューティングガイド作成

**対象ファイル**:
- 新規作成: `/tests/ナビゲーションテスト実行結果.md`
- 新規作成: `/docs/WordPress固定ページ設定ガイド.md`

## 実装詳細

### 1. 固定ページ作成スクリプト
```php
<?php
/**
 * 固定ページ自動作成機能
 */
function kei_portfolio_create_pages() {
    $pages = array(
        array(
            'title' => 'About',
            'slug' => 'about',
            'template' => 'page-templates/page-about.php',
            'content' => 'About page content'
        ),
        array(
            'title' => 'Skills',
            'slug' => 'skills',
            'template' => 'page-templates/page-skills.php',
            'content' => 'Skills page content'
        ),
        array(
            'title' => 'Portfolio',
            'slug' => 'portfolio',
            'template' => 'page-templates/page-portfolio.php',
            'content' => 'Portfolio page content'
        ),
        array(
            'title' => 'Contact',
            'slug' => 'contact',
            'template' => 'page-templates/page-contact.php',
            'content' => 'Contact page content'
        )
    );

    foreach ($pages as $page_data) {
        // ページが存在するかチェック
        $page = get_page_by_path($page_data['slug']);
        
        if (!$page) {
            // ページを作成
            $page_id = wp_insert_post(array(
                'post_title' => $page_data['title'],
                'post_name' => $page_data['slug'],
                'post_content' => $page_data['content'],
                'post_status' => 'publish',
                'post_type' => 'page',
                'post_author' => 1
            ));

            // テンプレートを設定
            if ($page_id && !is_wp_error($page_id)) {
                update_post_meta($page_id, '_wp_page_template', $page_data['template']);
            }
        }
    }
}
```

### 2. ナビゲーションメニュー自動設定
```php
<?php
/**
 * ナビゲーションメニューの自動設定
 */
function kei_portfolio_setup_navigation_menu() {
    $menu_name = 'Primary Navigation';
    $menu_exists = wp_get_nav_menu_object($menu_name);

    if (!$menu_exists) {
        $menu_id = wp_create_nav_menu($menu_name);

        // メニュー項目を追加
        $menu_items = array(
            'Home' => home_url('/'),
            'About' => home_url('/about/'),
            'Skills' => home_url('/skills/'),
            'Portfolio' => home_url('/portfolio/'),
            'Contact' => home_url('/contact/')
        );

        foreach ($menu_items as $title => $url) {
            wp_update_nav_menu_item($menu_id, 0, array(
                'menu-item-title' => $title,
                'menu-item-url' => $url,
                'menu-item-status' => 'publish'
            ));
        }

        // メニュー位置を設定
        $locations = get_theme_mod('nav_menu_locations');
        $locations['primary'] = $menu_id;
        set_theme_mod('nav_menu_locations', $locations);
    }
}
```

## テスト戦略

### 1. 単体テスト
- 固定ページ作成関数のテスト
- テンプレート割り当てテスト
- メニュー作成関数のテスト

### 2. 統合テスト
- 全ページへのHTTPアクセステスト（200 OKの確認）
- テンプレート適用の確認
- ナビゲーションリンクの動作確認

### 3. E2Eテスト
- ブラウザでの実際のナビゲーション動作確認
- 各ページのコンテンツ表示確認
- レスポンシブデザインの確認

## リスクと対策

### リスク
1. **既存ページとの競合**: 同じスラッグのページが存在する可能性
2. **パーマリンク設定の影響**: パーマリンク設定によってURLが変わる
3. **キャッシュの影響**: ページ作成後もキャッシュで404が表示される

### 対策
1. **競合チェック**: ページ作成前に既存ページをチェック
2. **パーマリンク更新**: ページ作成後にrewrite rulesをフラッシュ
3. **キャッシュクリア**: 実装後にキャッシュクリア手順を案内

## 実装優先順位
1. **最優先**: グループ1（固定ページ作成）
2. **高優先**: グループ2（テストとデータ投入）
3. **通常**: グループ3（検証とドキュメント）

## 成功基準
- [ ] 全ナビゲーションリンクが正常にアクセス可能（404エラーなし）
- [ ] 各ページで適切なテンプレートが適用される
- [ ] テストカバレッジ80%以上
- [ ] ドキュメント完備

## 実装後の確認項目
1. WordPress管理画面で固定ページ一覧を確認
2. 各ページのテンプレート設定を確認
3. パーマリンク設定を「投稿名」に設定
4. ナビゲーションメニューの表示確認
5. 全ページのブラウザアクセステスト