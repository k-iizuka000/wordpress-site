# 【改善版】React→WordPress(PHP)変換プロンプト

## 作業指示
[@2bbc0f61-e79d-4b52-8d58-797a775552ed_5/]のReactサイト（全33ファイル）をWordPress(PHP)に変換する。

## 作業手順

### Phase 1: 設計
design-architect-react-phpエージェントを呼び出し：
「[@2bbc0f61-e79d-4b52-8d58-797a775552ed_5/]を分析し、以下を作成：
 1. 変換対象ファイル一覧（[@doc/変換作業一覧.md]）
    - 全33ファイルを10グループに均等分割
    - グループ1-7: 各3ファイル担当（計21ファイル）
    - グループ8-10: 各4ファイル担当（計12ファイル）
 2. 変換ガイドライン（[@doc/変換ガイドライン.md]）
 3. WordPress構造設計（[@doc/WP構造設計.md]）」

### Phase 2: 並列実装（最大10並列）
以下の10個のreact-php-implementation-expertエージェントを同時実行：

#### 実装エージェント1-7（各3ファイル担当）
「[@doc/変換作業一覧.md]のグループ[N]（3ファイル）を変換：
 - 出力先: [@php/]の適切なサブディレクトリ
 - ログ: [@doc/変換ログ_グループ[N].md]
 - 進捗: 各ファイル変換完了時に記録」

#### 実装エージェント8-10（各4ファイル担当）
「[@doc/変換作業一覧.md]のグループ[N]（4ファイル）を変換：
 - 出力先: [@php/]の適切なサブディレクトリ
 - ログ: [@doc/変換ログ_グループ[N].md]
 - 進捗: 各ファイル変換完了時に記録」

### Phase 3: 初回レビュー
code-review-post-implementationエージェントを呼び出し：
「[@php/]の全33ファイルをレビューし、以下の観点で問題点を抽出：
 1. React→PHP変換の正確性
 2. WordPress標準への準拠
 3. セキュリティ脆弱性
 4. パフォーマンス問題
 
 出力形式（[@review/初回レビュー.md]）：
 ## グループ1（3ファイル）
 - [ ] ファイル1: components/header.php
   - 問題1: セキュリティ - XSS脆弱性
     - 修正方法: esc_html()でサニタイズ
 - [ ] ファイル2: components/footer.php
   - 問題なし
 
 ## グループ8（4ファイル）
 ...（全10グループ分）」

### Phase 4: 問題修正（並列実行）
問題のあるグループ数に応じて並列でreact-php-implementation-expertエージェントを呼び出し：
「[@review/初回レビュー.md]のグループ[N]の問題を修正：
 1. チェックなしの項目のみ修正
 2. 各問題の修正方法に従って実装
 3. 修正完了したらチェックを付ける
 4. 修正内容を[@doc/修正履歴_グループ[N].md]に記録」

注：問題のあるグループが10以下なら全て並列実行、11以上なら10個ずつバッチ処理

### Phase 5: 再レビュー
code-review-post-implementationエージェントを呼び出し：
「[@review/初回レビュー.md]で問題があったファイルのみ再レビュー：
 1. 修正が適切に実施されたか確認
 2. 新たな問題が発生していないか確認
 
 出力（[@review/再レビュー.md]）：
 ## 修正確認結果
 - ✅ グループ1/ファイル1: 全問題解決
 - ⚠️ グループ3/ファイル2: 新問題発見
   - 問題: CSRF対策不足
   - 修正方法: wp_nonce_field()追加」

### Phase 6: 最終修正（必要に応じて）
再レビューで問題が残っている場合：
「Phase 4と同様の手順で[@review/再レビュー.md]の問題を修正
 最大10並列で実行」

### Phase 7: 完了確認
「[@review/再レビュー.md]の全項目が✅になったら作業完了
 最終成果物：
 - 変換済み33ファイル（[@php/]配下）
 - 納品物一覧（[@doc/納品物一覧.md]）
 - 変換ログ（[@doc/変換ログ_統合.md]）」

## 並列実行の注意事項
- Claude Codeは最大10個のタスクを同時実行可能
- 33ファイルを10グループに均等分割（3-3-3-3-3-3-3-4-4-4）
- 修正フェーズも最大10並列で実行し、時間短縮

## エージェント呼び出しの詳細プロンプト

### Phase 1: design-architect-react-phpエージェント用プロンプト
```
[@2bbc0f61-e79d-4b52-8d58-797a775552ed_5/]のReactプロジェクトを分析し、WordPress(PHP)への変換設計を行ってください。

作成するドキュメント：

1. 変換対象ファイル一覧（[@doc/変換作業一覧.md]）
   ## グループ分割（全33ファイルを10グループに均等分割）
   
   ### グループ1（3ファイル）
   - [ ] 2bbc0f61-e79d-4b52-8d58-797a775552ed_5/components/Header.tsx
   - [ ] 2bbc0f61-e79d-4b52-8d58-797a775552ed_5/components/Footer.tsx
   - [ ] 2bbc0f61-e79d-4b52-8d58-797a775552ed_5/app/layout.tsx
   
   ### グループ2（3ファイル）
   - [ ] 2bbc0f61-e79d-4b52-8d58-797a775552ed_5/app/page.tsx
   - [ ] 2bbc0f61-e79d-4b52-8d58-797a775552ed_5/app/about/page.tsx
   - [ ] 2bbc0f61-e79d-4b52-8d58-797a775552ed_5/app/about/AboutHero.tsx
   
   ...（全10グループ、グループ1-7は各3ファイル、グループ8-10は各4ファイル）

2. 変換ガイドライン（[@doc/変換ガイドライン.md]）
   - JSX→PHP変換ルール
   - React Hooks→PHP/JS実装方法
   - Tailwind CSS→WordPress統合方法
   - 状態管理の移行戦略
   - ルーティングの対応表

3. WordPress構造設計（[@doc/WP構造設計.md]）
   - テーマディレクトリ構造
   - カスタム投稿タイプ定義
   - テンプレート階層
   - functions.php機能一覧
   - 必要なプラグイン一覧
```

### Phase 2: react-php-implementation-expertエージェント用プロンプト（グループ1-7用）
```
[@doc/変換作業一覧.md]のグループ[N]（3ファイル）をReactからPHPに変換してください。

変換対象：
- ファイル1: [ファイルパス]
- ファイル2: [ファイルパス]
- ファイル3: [ファイルパス]

変換ルール：
- [@doc/変換ガイドライン.md]の全ルールに従う
- [@doc/WP構造設計.md]のディレクトリ構造に従う

出力先：
- [@php/]の適切なサブディレクトリ
  - コンポーネント系 → [@php/components/]
  - ページテンプレート系 → [@php/templates/]
  - パーツテンプレート系 → [@php/template-parts/]
  - アセット系 → [@php/assets/]

進捗記録：
- 各ファイル変換完了時に[@doc/変換ログ_グループ[N].md]に記録
- 形式：
  - ✅ ファイル1: [元パス] → [新パス] - 変換完了
  - ✅ ファイル2: [元パス] → [新パス] - 変換完了
  - ✅ ファイル3: [元パス] → [新パス] - 変換完了

注意事項：
- WordPressのエスケープ関数（esc_html(), esc_attr()等）を適切に使用
- wp_enqueue_style/scriptでアセットを管理
- カスタムフィールドはACFまたはカスタムメタボックスで実装
```

### Phase 2: react-php-implementation-expertエージェント用プロンプト（グループ8-10用）
```
[@doc/変換作業一覧.md]のグループ[N]（4ファイル）をReactからPHPに変換してください。

変換対象：
- ファイル1: [ファイルパス]
- ファイル2: [ファイルパス]
- ファイル3: [ファイルパス]
- ファイル4: [ファイルパス]

[以下、グループ1-7用と同じ内容]
```

### Phase 3: code-review-post-implementationエージェント用プロンプト
```
[@php/]ディレクトリの全33ファイルをレビューしてください。

レビュー観点：
1. React→PHP変換の正確性
   - JSX構文が正しくPHPに変換されているか
   - 条件分岐やループが適切に実装されているか
   
2. WordPress標準への準拠
   - WordPress Coding Standardsに従っているか
   - テンプレート階層が正しいか
   - フック（action/filter）の使用が適切か
   
3. セキュリティ脆弱性
   - XSS対策（エスケープ処理）
   - SQLインジェクション対策
   - CSRF対策（nonce使用）
   - ファイルアップロード制限
   
4. パフォーマンス問題
   - 不要なデータベースクエリ
   - アセットの最適化
   - キャッシュの活用

出力形式（[@review/初回レビュー.md]）：
## グループ1（3ファイル）
- [ ] components/header.php
  - 問題1: [カテゴリ] - [問題の詳細]
    - 修正方法: [具体的な修正内容]
  - 問題2: [カテゴリ] - [問題の詳細]
    - 修正方法: [具体的な修正内容]
    
- [ ] components/footer.php
  - 問題なし
  
[全10グループ分記載]

## サマリー
- 総ファイル数: 33
- 問題のあるファイル数: X
- 重大度別問題数：
  - 🔴 Critical: X件
  - 🟡 Warning: X件
  - 🔵 Info: X件
```

### Phase 4: react-php-implementation-expertエージェント用プロンプト（修正用）
```
[@review/初回レビュー.md]のグループ[N]の問題を修正してください。

修正対象：
[グループ[N]の問題リスト]

修正手順：
1. 各ファイルの問題を「修正方法」に従って修正
2. 修正完了後、[@review/初回レビュー.md]の該当項目にチェック（[x]）を付ける
3. 修正内容を[@doc/修正履歴_グループ[N].md]に記録

修正履歴の形式（[@doc/修正履歴_グループ[N].md]）：
## 修正履歴 - グループ[N]
### components/header.php
- 問題1: XSS脆弱性
  - 修正前: `<?php echo $title; ?>`
  - 修正後: `<?php echo esc_html($title); ?>`
  - 修正日時: YYYY-MM-DD HH:MM

注意事項：
- 修正により新たな問題を発生させない
- 既存の正常な動作を維持
- WordPress標準に準拠した修正を行う
```

### Phase 5: code-review-post-implementationエージェント用プロンプト（再レビュー用）
```
[@review/初回レビュー.md]で問題があったファイルのみ再レビューしてください。

レビュー対象：
[初回レビューで問題があったファイルリスト]

確認事項：
1. 指摘された問題が適切に修正されているか
2. 修正により新たな問題が発生していないか
3. WordPress標準に準拠しているか

出力形式（[@review/再レビュー.md]）：
## 修正確認結果

### ✅ 完全に修正されたファイル
- グループ1/components/header.php: 全問題解決
- グループ2/templates/page-about.php: 全問題解決

### ⚠️ 追加修正が必要なファイル
- グループ3/components/navigation.php
  - 新問題: CSRF対策不足
    - 修正方法: wp_nonce_field()を追加
  - 新問題: メニュー項目のエスケープ漏れ
    - 修正方法: esc_attr()でサニタイズ

### 📊 統計
- 再レビュー対象: X件
- 完全修正: X件
- 追加修正必要: X件
- 修正成功率: XX%
```

### Phase 6: react-php-implementation-expertエージェント用プロンプト（最終修正用）
```
[@review/再レビュー.md]の「追加修正が必要なファイル」を修正してください。

[以下、Phase 4と同じ形式]
```

## 実行時の注意事項

### 並列実行の管理
1. Phase 2では10個のエージェントを同時に起動
2. 各エージェントの完了を待ってからPhase 3へ進む
3. Phase 4では問題のあるグループ数に応じて並列数を調整

### ファイル管理
1. 変換前のReactファイルは変更しない
2. 変換後のPHPファイルは[@php/]配下に整理
3. ログとレビュー結果は適切なディレクトリに保存

### 品質管理
1. 各フェーズ完了後に成果物を確認
2. エラーが発生した場合は該当グループのみ再実行
3. 最終的に全ファイルが正常に変換されたことを確認

### トラブルシューティング
1. エージェントがタイムアウトした場合
   - 該当グループのみ再実行
   - ファイル数を減らして再グループ化を検討

2. 変換エラーが発生した場合
   - エラーログを確認
   - 変換ガイドラインを更新
   - 該当ファイルのみ再変換

3. レビューで多数の問題が発見された場合
   - 共通的な問題をガイドラインに追加
   - 全グループで同様の修正を実施