# 404エラー修正手順書

## 問題の概要
WordPressサイト移行後、ホームページから他のページへの遷移時に404エラーが発生

## 原因
`.htaccess`ファイルが移行されていなかったため、WordPressのパーマリンクが正しく機能していない

## 修正内容

### 1. 作成したファイル
- `/Users/kei/work/wordpress-site/wordpress/.htaccess` - ローカル開発環境用
- `/Users/kei/work/wordpress-site/themes/kei-portfolio-upload/.htaccess` - 本番環境用（テーマに含める）

### 2. スクリプトの修正
`export-wordpress-site.sh`を以下のように修正：
- .htaccessファイルをエクスポートに含めるよう追加
- チェックリストに.htaccess設置手順を追加
- トラブルシューティングセクションを強化

## 再実行手順

### ステップ1: スクリプトの実行
```bash
cd /Users/kei/work/wordpress-site
./export-wordpress-site.sh
```

### ステップ2: 生成されたファイルの確認
```bash
ls -la site-exports/[最新の日時]/
# 以下のファイルが存在することを確認：
# - kei-portfolio-theme_*.tar.gz
# - database_*.sql
# - database_*.sql.gz
# - htaccess-root  ← 新規追加
# - migration-checklist.md
```

### ステップ3: 本番環境への移行

#### 3-1. .htaccessファイルの設置（最重要）
```bash
# 本番環境のWordPressルートディレクトリで実行
cp htaccess-root .htaccess
chmod 644 .htaccess
chown www-data:www-data .htaccess  # または適切なWebサーバーユーザー
```

#### 3-2. テーマファイルの展開
```bash
cd /path/to/wordpress/wp-content/themes/
tar xzf kei-portfolio-theme_*.tar.gz
chmod -R 755 kei-portfolio
chown -R www-data:www-data kei-portfolio
```

#### 3-3. データベースのインポート
```bash
mysql -u [username] -p [database_name] < database_*.sql
```

### ステップ4: WordPress管理画面での設定

1. **パーマリンク設定の更新（必須）**
   - WordPress管理画面にログイン
   - 設定 → パーマリンク設定
   - 何も変更せずに「変更を保存」をクリック
   - これにより.htaccessが再生成される

2. **テーマの有効化**
   - 外観 → テーマ
   - kei-portfolioテーマを有効化

### ステップ5: 動作確認

1. **基本的な動作確認**
   - トップページが表示されること
   - メニューリンクが正しく動作すること
   - 各固定ページ（About, Skills, Portfolio, Contact）が表示されること

2. **詳細な確認**
   - ブラウザのコンソールでJavaScriptエラーがないこと
   - portfolio.jsonのデータが正しく表示されること
   - お問い合わせフォームが動作すること

## トラブルシューティング

### それでも404エラーが発生する場合

1. **Apacheの設定確認**
   ```bash
   # mod_rewriteモジュールが有効か確認
   apache2ctl -M | grep rewrite
   
   # 有効でない場合は有効化
   a2enmod rewrite
   systemctl restart apache2
   ```

2. **サーバー設定の確認**
   - Apacheの設定ファイル（httpd.conf や サイト設定）で `AllowOverride All` が設定されているか確認
   ```apache
   <Directory /path/to/wordpress>
       AllowOverride All
   </Directory>
   ```

3. **ファイルの存在確認**
   ```bash
   # .htaccessが存在し、読み取り可能か確認
   ls -la /path/to/wordpress/.htaccess
   cat /path/to/wordpress/.htaccess
   ```

4. **WordPress設定の確認**
   - wp-config.phpでサイトURLが正しく設定されているか確認
   ```php
   define('WP_HOME', 'https://kei-aokiki.dev');
   define('WP_SITEURL', 'https://kei-aokiki.dev');
   ```

## 補足情報

### .htaccessファイルの役割
- URLリライト：きれいなURL（パーマリンク）を実現
- セキュリティ：重要ファイルへのアクセス制限
- パフォーマンス：GZIP圧縮、キャッシュ制御
- セキュリティヘッダー：XSS対策、クリックジャッキング対策など

### 今後の注意点
- WordPressの更新時に.htaccessが上書きされる可能性があるため、バックアップを保持する
- パーマリンク設定を変更した際は、必ず.htaccessが正しく更新されているか確認する
- サーバー移行時は必ず.htaccessファイルも一緒に移行する