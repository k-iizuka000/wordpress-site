# 本番環境修正手順書
作成日: 2025-08-08

## 🚨 緊急対応手順

### 現在の問題
- **ローカル環境**: 正しい内容（Kei Aokikiのポートフォリオ）が表示
- **本番環境**: 誤った内容（田中健太のポートフォリオ）が表示

## 📋 修正手順

### Step 1: ホスティング環境の確認（5分）

#### 1.1 ロリポップ管理画面へログイン
```
1. https://user.lolipop.jp/ にアクセス
2. ログイン情報を入力
3. 管理画面へアクセス
```

#### 1.2 WordPressインストール状況確認
```
管理画面 > サイト作成ツール > WordPress簡単インストール
- インストール済みのWordPress一覧を確認
- kei-aokiki.dev のインストール状況を確認
```

### Step 2: FTPで本番環境のファイル確認（10分）

#### 2.1 FTP接続情報の取得
```
ロリポップ管理画面 > サーバーの管理・設定 > FTP・WebDAV
- FTPサーバー名
- FTPユーザー名
- FTPパスワード
```

#### 2.2 FTPクライアントで接続
```bash
# コマンドラインの場合
ftp [FTPサーバー名]
# ユーザー名とパスワードを入力

# FileZillaなどのGUIツールも使用可能
```

#### 2.3 テーマディレクトリの確認
```
/wp-content/themes/
- 現在有効なテーマを確認
- ファイルの内容を確認
```

### Step 3: データベースの確認（10分）

#### 3.1 phpMyAdminへアクセス
```
ロリポップ管理画面 > サーバーの管理・設定 > データベース
- phpMyAdminを開く
```

#### 3.2 WordPressテーブルの確認
```sql
-- サイトURLの確認
SELECT * FROM wp_options 
WHERE option_name IN ('siteurl', 'home');

-- 投稿内容の確認
SELECT post_title, post_content 
FROM wp_posts 
WHERE post_type = 'page' 
LIMIT 10;

-- ユーザー情報の確認
SELECT user_login, user_email, display_name 
FROM wp_users;
```

### Step 4: 正しいコンテンツのアップロード（30分）

#### 4.1 ローカルテーマの準備
```bash
# ローカル環境でテーマを圧縮
cd /Users/kei/work/wordpress-site/themes/
zip -r kei-portfolio-upload.zip kei-portfolio/
```

#### 4.2 FTPでアップロード
```bash
# 本番環境の既存テーマをバックアップ
mv /wp-content/themes/現在のテーマ /wp-content/themes/現在のテーマ_backup

# 新しいテーマをアップロード
# FTPクライアントでkei-portfolio-upload.zipをアップロード
# /wp-content/themes/に展開
```

#### 4.3 WordPress管理画面でテーマ有効化
```
1. https://kei-aokiki.dev/wp-admin にアクセス
2. 外観 > テーマ
3. kei-portfolioテーマを有効化
```

### Step 5: データベースの修正（15分）

#### 5.1 必要に応じてデータベース内容を更新

```sql
-- サイト情報の更新
UPDATE wp_options 
SET option_value = 'Kei Aokiki Portfolio' 
WHERE option_name = 'blogname';

UPDATE wp_options 
SET option_value = 'ソフトウェアエンジニア - 10年以上の経験' 
WHERE option_name = 'blogdescription';
```

#### 5.2 固定ページの作成（必要な場合）
```php
// Docker環境からデータをエクスポート
docker exec kei-portfolio-dev wp db export /tmp/local_data.sql

// 本番環境にインポート
// phpMyAdminでlocal_data.sqlをインポート
```

### Step 6: 動作確認（10分）

#### 6.1 基本動作確認
- [ ] トップページの表示確認
- [ ] About、Skills、Contact、Portfolioページへのリンク確認
- [ ] お問い合わせフォームの動作確認
- [ ] レスポンシブデザインの確認（スマートフォン表示）

#### 6.2 コンテンツ確認
- [ ] 名前が「Kei Aokiki」になっているか
- [ ] 経歴が「10年以上のシステム開発経験」になっているか
- [ ] 技術スタックが「Java/Spring Boot中心」になっているか

### Step 7: キャッシュクリア（5分）

#### 7.1 WordPressキャッシュクリア
```
WordPress管理画面 > 設定 > パーマリンク
「変更を保存」をクリック（設定は変更しない）
```

#### 7.2 ブラウザキャッシュクリア
```
Chrome: Cmd+Shift+R (Mac) / Ctrl+Shift+R (Windows)
Safari: Cmd+Option+E
Firefox: Cmd+Shift+R (Mac) / Ctrl+Shift+R (Windows)
```

#### 7.3 CDNキャッシュクリア（使用している場合）
CDN管理画面でキャッシュパージを実行

## 🔧 トラブルシューティング

### 問題: FTPでアクセスできない
**解決策**:
- ロリポップのファイルマネージャーを使用
- SSH接続を試す（ロリポップで有効化が必要）

### 問題: テーマが有効化できない
**解決策**:
```bash
# functions.phpの構文エラーチェック
php -l functions.php

# 必要なディレクトリの権限確認
chmod 755 /wp-content/themes/kei-portfolio
chmod 644 /wp-content/themes/kei-portfolio/*.php
```

### 問題: データベース更新が反映されない
**解決策**:
```sql
-- オブジェクトキャッシュのクリア
DELETE FROM wp_options WHERE option_name LIKE '_transient_%';
DELETE FROM wp_options WHERE option_name LIKE '_site_transient_%';
```

## 📝 確認チェックリスト

### 修正前の確認
- [ ] 現在の本番環境のバックアップ作成
- [ ] データベースのエクスポート完了
- [ ] FTP接続情報の確認

### 修正後の確認
- [ ] 正しい名前（Kei Aokiki）が表示されている
- [ ] 正しい技術スタック（Java/Spring Boot）が表示されている
- [ ] 全ページが正常にアクセス可能
- [ ] お問い合わせフォームが動作する
- [ ] モバイル表示が正常

## 🚀 推奨される長期的改善

### 1. デプロイプロセスの自動化
```yaml
# GitHub Actionsでの自動デプロイ設定例
name: Deploy to Production
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Deploy to Lollipop
        run: |
          # FTP or rsyncでデプロイ
```

### 2. ステージング環境の構築
- kei-portfolio.icurus.jp をステージング環境として活用
- 本番デプロイ前の確認環境として使用

### 3. バージョン管理の強化
- テーマにバージョン番号を付与
- デプロイ履歴の記録
- ロールバック手順の明文化

## 📞 サポート連絡先

### ロリポップサポート
- 電話: 0570-064-325
- メール: サポートフォームから
- 営業時間: 平日10:00-18:00

### エスカレーション
問題が解決しない場合:
1. ロリポップのチャットサポートを利用
2. 技術サポートチケットを作成
3. WordPress.orgフォーラムで相談

---

**重要**: 作業前に必ずバックアップを作成してください。
**推定作業時間**: 約1-2時間